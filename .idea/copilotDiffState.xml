<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/SISTEMA_RECUPERACION_PASSWORD.md">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SISTEMA_RECUPERACION_PASSWORD.md" />
              <option name="updatedContent" value="#  Sistema de Recuperación de Contraseña - HomePass IoT&#10;&#10;## ✅ Estado: COMPLETADO Y FUNCIONAL&#10;&#10;**Última actualización:** 3 de diciembre de 2025  &#10;**Prueba exitosa:** Email enviado a savka.carvajal@inacapmail.cl ✅&#10;&#10;---&#10;&#10;##  Funcionalidades&#10;&#10;### ✅ Envío de Códigos por Email&#10;- **Destinatarios:** Cualquier proveedor (Gmail, INACAP, Outlook, Yahoo, etc.)&#10;- **Formato:** Email HTML profesional&#10;- **Códigos:** 5 dígitos aleatorios&#10;- **Expiración:** 15 minutos&#10;- **SMTP:** Gmail (smtp.gmail.com:587)&#10;&#10;### ✅ Validación y Cambio de Contraseña&#10;- Validación de códigos con expiración&#10;- Cambio seguro de contraseña (bcrypt)&#10;- Prepared statements (SQL injection protection)&#10;&#10;---&#10;&#10;##  Archivos del Sistema&#10;&#10;### Backend PHP (en servidor)&#10;```&#10;/var/www/html/&#10;├── solicitar_codigo_con_email.php   # Genera y envía código&#10;├── validar_codigo.php                # Valida código y expiración&#10;├── apimodificarclave.php             # Cambia contraseña&#10;├── email_config.php                  # Configuración SMTP&#10;└── conexion.php                      # Conexión a BD&#10;```&#10;&#10;### Base de Datos&#10;```sql&#10;CREATE TABLE password_resets (&#10;    id INT AUTO_INCREMENT PRIMARY KEY,&#10;    email VARCHAR(255) NOT NULL,&#10;    code VARCHAR(5) NOT NULL,&#10;    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,&#10;    expires_at TIMESTAMP DEFAULT (CURRENT_TIMESTAMP + INTERVAL 15 MINUTE)&#10;);&#10;```&#10;&#10;---&#10;&#10;##  Uso desde la App Android&#10;&#10;### 1. Solicitar Código&#10;```kotlin&#10;// POST a solicitar_codigo_con_email.php&#10;val params = mapOf(&quot;email&quot; to userEmail)&#10;&#10;// Respuesta:&#10;// {&quot;status&quot;: &quot;success&quot;, &quot;message&quot;: &quot;Código enviado a tu correo&quot;}&#10;```&#10;&#10;### 2. Validar Código&#10;```kotlin&#10;// POST a validar_codigo.php&#10;val params = mapOf(&#10;    &quot;email&quot; to userEmail,&#10;    &quot;code&quot; to userCode&#10;)&#10;&#10;// Respuesta:&#10;// {&quot;status&quot;: &quot;success&quot;, &quot;message&quot;: &quot;Código válido&quot;}&#10;```&#10;&#10;### 3. Cambiar Contraseña&#10;```kotlin&#10;// POST a apimodificarclave.php&#10;val params = mapOf(&#10;    &quot;email&quot; to userEmail,&#10;    &quot;nuevaclave&quot; to newPassword&#10;)&#10;&#10;// Respuesta:&#10;// {&quot;status&quot;: &quot;success&quot;, &quot;message&quot;: &quot;Contraseña actualizada&quot;}&#10;```&#10;&#10;---&#10;&#10;##  Configuración SMTP (email_config.php)&#10;&#10;```php&#10;define('SMTP_HOST', 'smtp.gmail.com');&#10;define('SMTP_PORT', 587);&#10;define('SMTP_SECURE', 'tls');&#10;define('SMTP_USERNAME', 'savkacarvajalg1@gmail.com');&#10;define('SMTP_PASSWORD', 'zjewbamfuzzftmbi'); // Contraseña de aplicación&#10;define('FROM_EMAIL', 'savkacarvajalg1@gmail.com');&#10;define('FROM_NAME', 'HomePass IoT');&#10;```&#10;&#10;### Requisitos:&#10;- PHPMailer instalado: `composer require phpmailer/phpmailer`&#10;- Contraseña de aplicación Gmail (2FA activado)&#10;- Generar en: https://myaccount.google.com/apppasswords&#10;&#10;---&#10;&#10;##  Pruebas&#10;&#10;### Probar envío de email:&#10;```&#10;http://44.199.155.199/test_envio_simple.php?email=TU_EMAIL&#10;```&#10;&#10;### Ver código temporal (solo desarrollo):&#10;```&#10;http://44.199.155.199/ver_codigo_temporal.php?email=EMAIL_USUARIO&#10;```&#10;&#10;---&#10;&#10;##  Seguridad&#10;&#10;- ✅ Códigos aleatorios (100,000 combinaciones)&#10;- ✅ Expiración automática (15 min)&#10;- ✅ Prepared statements (SQL injection protection)&#10;- ✅ Sanitización de inputs&#10;- ✅ Contraseñas cifradas con bcrypt&#10;- ✅ Mensaje genérico si email no existe (privacidad)&#10;&#10;---&#10;&#10;##  Pruebas Realizadas&#10;&#10;| Email | Proveedor | Resultado | Fecha |&#10;|-------|-----------|-----------|-------|&#10;| savka.carvajal@inacapmail.cl | INACAP | ✅ Exitoso | 2025-12-03 |&#10;| savkacarvajalg1@gmail.com | Gmail | ✅ Funciona | 2025-12-03 |&#10;&#10;**Conclusión:** El sistema envía a cualquier proveedor de email sin restricciones.&#10;&#10;---&#10;&#10;##  Troubleshooting&#10;&#10;### Error: &quot;SMTP Could not authenticate&quot;&#10;**Solución:**&#10;1. Verifica que la verificación en 2 pasos esté activa en Gmail&#10;2. Genera nueva contraseña de aplicación&#10;3. Actualiza `SMTP_PASSWORD` en `email_config.php`&#10;&#10;### Error: &quot;PHPMailer not found&quot;&#10;**Solución:**&#10;```bash&#10;ssh ec2-user@44.199.155.199&#10;cd /var/www/html&#10;composer require phpmailer/phpmailer&#10;```&#10;&#10;### Email no llega&#10;**Verificar:**&#10;- ✅ Carpeta de SPAM&#10;- ✅ Email escrito correctamente&#10;- ✅ Usuario existe en la base de datos&#10;- ✅ Probar con: `test_envio_simple.php`&#10;&#10;---&#10;&#10;##  Notas de Producción&#10;&#10;- **Límite Gmail:** 500 emails/día (cuenta gratuita)&#10;- **Alternativas:** SendGrid (100/día gratis), Amazon SES, Mailgun&#10;- **Monitoreo:** Revisar logs en servidor para errores SMTP&#10;- **Backup:** Mantener contraseña de app en lugar seguro&#10;&#10;---&#10;&#10;**Desarrollado por:** Savka Carvajal &amp; Dante Gutierrez  &#10;**Proyecto:** HomePass IoT - Aplicaciones Móviles para IoT  &#10;**Institución:** INACAP 2025&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>